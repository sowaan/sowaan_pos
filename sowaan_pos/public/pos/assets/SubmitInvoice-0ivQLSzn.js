var L=Object.defineProperty,M=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var w=(o,l,a)=>l in o?L(o,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[l]=a,h=(o,l)=>{for(var a in l||(l={}))E.call(l,a)&&w(o,a,l[a]);if(T)for(var a of T(l))J.call(l,a)&&w(o,a,l[a]);return o},f=(o,l)=>M(o,V(l));import{c as A,d as q,u as F,b as G,W as R,r as u,j as e,e as m,g as C,y as v,a as W,p as $}from"./index-dBLn7d2G.js";import{c as H}from"./index-k6Vii9ZT.js";import{C as r}from"./index-B20hc4J4.js";const Y=()=>{const o=A(),l=q(),{state:a}=F(),{value:d}=G(s=>s.posprofile),{data:b,isLoading:S}=R("posawesome.posawesome.api.posapp.get_sales_person_names"),x=u.useCallback(()=>{var s;return(s=d==null?void 0:d.payments)==null?void 0:s.reduce((t,n)=>(t[n.mode_of_payment]=n.default===1?a.subTotal:0,t),{})},[d,a.subTotal]),[p,y]=u.useState(x),[k,P]=u.useState(""),[j,g]=u.useState(!1),i=u.useMemo(()=>Object.values(p).reduce((s,t)=>s+Number(t),0),[p]),I=u.useMemo(()=>Math.abs(i-a.subTotal),[i,a.subTotal]),O=u.useCallback((s,t)=>{const n=Math.max(0,Number(t));y(c=>f(h({},c),{[s]:n}))},[]),z=u.useCallback(s=>{y(()=>{const t=x();return Object.keys(t).forEach(n=>t[n]=0),t[s]=a.subTotal,t})},[x,a.subTotal]),D=()=>{let s=a.invoice;if(!s.is_return&&a.subTotal<0){v.error("Please enter a valid amount");return}g(!0);let t={total_change:s.is_return?0:Math.max(a.subTotal-i,0),paid_change:s.is_return?0:I,credit_change:0,redeemed_customer_credit:0,customer_credit_dict:[],is_cashback:!0};s.payments=s.payments.map(c=>f(h({},c),{amount:p[c.mode_of_payment]||0}));let n=new FormData;n.append("data",JSON.stringify(t)),n.append("invoice",JSON.stringify(s)),W.post("/api/method/posawesome.posawesome.api.posapp.submit_invoice",n).then(()=>{v.success("Invoice submitted successfully!"),o($()),o(C("")),l("/"),g(!1)}).catch(c=>{var _,N;const B=JSON.parse((N=(_=c.response)==null?void 0:_.data)==null?void 0:N._server_messages);v.error(JSON.parse(B).message||"Failed to submit invoice."),g(!1)})};return e.jsxs("div",{className:"overflow-y-auto mx-auto py-5 pt-0 px-3 flex flex-col h-full bg-white border-l border-gray-200",children:[e.jsx("div",{className:"container mx-auto sticky top-0 bg-white z-10 py-5 px-1 md:px-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{"aria-controls":"sidebar",onClick:()=>l(-1),className:"cursor-pointer  flex title-font mr-2 p-3 font-medium items-center text-gray-900 rounded-lg bg-gray-200 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200",children:e.jsx(H,{})}),e.jsx("h1",{className:"text-xl font-bold",children:"Payment"})]})}),e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto py-5",children:[e.jsxs("div",{className:" grid grid-cols-2 gap-2 sm:gap-4 px-0 sm:px-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Paid Amount",id:"paid_amount",type:"number",min:"0",value:i,disabled:!0})}),a.subTotal-i<0&&e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Change",id:"change",type:"number",disabled:!0,value:a.subTotal-i})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Paid Change",id:"paid_change",type:"number",disabled:!0,value:i>a.subTotal?i-a.subTotal:a.subTotal-i})}),a.subTotal-i<0&&e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Credit Change",id:"credit_change",type:"number",disabled:!0,value:0})})]}),e.jsx("div",{className:"sm:mx-4",children:d&&d.payments&&d.payments.map((s,t)=>e.jsxs("div",{className:"flex flex-row items-end",children:[e.jsx(r,{label:s.mode_of_payment,id:s.mode_of_payment,type:"number",required:!0,min:"0",value:p[s.mode_of_payment]||"",onChange:n=>O(s.mode_of_payment,n.target.value)}),e.jsx("div",{className:"m-2 sm:m-4"}),e.jsx(m.Button,{className:"w-full mb-4 cursor-pointer",color:"blue",size:"regular",onClick:()=>z(s.mode_of_payment),children:s.mode_of_payment})]},t))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4 px-0 sm:px-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Net Total",id:"net_total",type:"number",disabled:!0,value:a.subTotal})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Tax and Charges",id:"tax_and_charges",type:"number",disabled:!0,value:0})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Total Amount",id:"total_amount",type:"number",disabled:!0,value:a.subTotal})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Discount Amount",id:"discount_amount",type:"number",disabled:!0,value:0})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Grand Total",id:"grand_total",type:"number",disabled:!0,value:a.subTotal})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{label:"Round Total",id:"round_total",type:"number",disabled:!0,value:a.subTotal})}),e.jsxs("div",{className:"relative w-full mb-4",children:[e.jsx(m.Typography,{className:"leading-7 text-sm text-gray-700 my-1",children:"Sales Person"}),!S&&b&&e.jsx(m.Select,{required:!0,onChange:s=>P(s),value:k,labelProps:{className:"hidden"},className:"w-full bg-white rounded-lg border border-gray-300 focus:border-[#0277fa] focus:ring-2 focus:ring-[#3f99ff] text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out",children:b&&b.message.map((s,t)=>e.jsx(m.Option,{value:s.name,children:s.name},t))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-around ",children:[e.jsx(m.Button,{onClick:D,color:"blue",className:"cursor-pointer w-full sm:w-auto",size:"regular",disabled:j,children:j?"Loading ...":"Submit Payment"}),e.jsx("div",{className:"m-2 sm:m-0"}),e.jsx(m.Button,{onClick:()=>{o(C(a.invoice.name)),l(-1)},color:"red",className:"cursor-pointer w-full sm:w-auto",size:"regular",children:"Cancel Payment"})]})]})]})};export{Y as default};
